<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOST - RIVAL M√ÅS D√âBIL</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --primary: #00d2ff; --accent: #f1c40f; --danger: #ff0055; --success: #00ff9d; --glass: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; }
        body { margin:0; padding:10px; background:var(--bg); color:white; font-family:'Outfit'; height: 100dvh; width: 100vw; display:flex; flex-direction: column; gap:10px; overflow:hidden; }
        
        header { flex-shrink: 0; display:flex; justify-content:space-between; align-items:center; background:var(--glass); padding:0 20px; border-radius:12px; height: 70px; }
        .brand { font-weight:900; font-size:1.2rem; color:var(--primary); text-transform:uppercase; }
        .timer-box { font-size:2.5rem; font-weight:700; color:var(--primary); }
        .bank-box { text-align:right; } .bank-val { font-size:1.8rem; color:var(--accent); font-weight:bold; }

        .main-grid { flex: 1; display:grid; grid-template-columns: 250px 1fr 320px; gap:10px; min-height: 0; }
        .panel { background:var(--glass); border:1px solid rgba(255,255,255,0.1); border-radius:12px; padding:15px; display:flex; flex-direction:column; gap:10px; height: 100%; overflow: hidden; }
        
        .btn { padding:12px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; text-transform:uppercase; color:white; background:rgba(255,255,255,0.1); text-align:left; font-size: 0.9rem; transition: all 0.2s; }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        
        /* Highlight para el siguiente paso recomendado */
        .btn-next-step { border: 2px solid var(--primary); background: rgba(0, 210, 255, 0.2); box-shadow: 0 0 10px var(--primary); }
        
        .btn.active { background:var(--primary); color:black; }
        .btn-danger { color:var(--danger); border:1px solid var(--danger); }
        .btn-reset { margin-top: auto; background: #300; border: 1px solid #500; color: #f88; text-align: center; flex-shrink: 0; }

        .center-panel { display: flex; flex-direction: column; padding: 10px; position: relative; } 
        .turn-banner { text-align: center; background: rgba(0, 210, 255, 0.1); padding: 5px; border-radius: 5px; border: 1px solid var(--primary); color: var(--primary); font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; }

        .question-area { flex: 1; overflow-y: auto; padding: 20px; background: rgba(0,0,0,0.3); border-left: 4px solid var(--primary); border-radius: 8px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .voting-area { display: none; flex: 1; overflow-y: auto; background: rgba(0,0,0,0.5); border-radius: 8px; padding: 10px; }
        .vote-card { background: #222; margin-bottom: 5px; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; font-size: 1.1rem; }
        .voter-name { color: #888; font-size: 0.9rem; }
        .target-name { color: var(--danger); font-weight: bold; }
        
        .vote-alert { padding: 15px; text-align: center; font-weight: 900; font-size: 1.2rem; border-radius: 8px; margin-bottom: 10px; display: none; }
        .alert-elim { background: var(--danger); color: white; }
        .alert-tie { background: var(--accent); color: black; }

        .q-text { font-size:1.8rem; font-weight:bold; line-height:1.3; margin-bottom: 20px; }
        .a-text { font-size:1.5rem; color:var(--success); background:rgba(0,255,157,0.1); padding:5px 20px; border-radius:20px; }

        #hostLadder { display: flex; gap: 5px; justify-content: center; align-items: center; padding: 5px; background: rgba(0,0,0,0.5); border-radius: 5px; margin-bottom: 10px; overflow-x: auto; white-space: nowrap; flex-shrink: 0; }
        .h-step { padding: 5px 10px; background: #222; border-radius: 4px; font-size: 0.8rem; color: #555; }
        .h-step.active { background: var(--accent); color: black; font-weight: bold; transform: scale(1.1); }

        .controls-area { flex-shrink: 0; display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; height:80px; }
        .big-btn { border:none; border-radius:8px; font-weight:900; font-size:1.1rem; cursor:pointer; text-transform:uppercase; color: white; transition: 0.2s; }
        /* PUNTO 6: Botones desactivados */
        .big-btn:disabled { opacity: 0.2; filter: grayscale(100%); pointer-events: none; }
        
        .b-wrong { background:var(--danger); }
        .b-bank { background:var(--accent); color:black; display: flex; flex-direction: column; justify-content: center; align-items: center; line-height: 1; }
        .b-correct { background:var(--success); color:black; }

        select { width:100%; padding:10px; background:#222; color:white; border:1px solid #444; border-radius:5px; flex-shrink: 0; }
        
        .stat-header { display:flex; justify-content:space-between; font-size:0.8rem; color:#888; border-bottom:1px solid #555; padding:5px; margin-bottom:5px; }
        .stat-row { display:flex; justify-content:space-between; font-size:0.9rem; border-bottom:1px solid #333; padding:8px 0; }
        .col-name { flex: 2; font-weight: bold; }
        .col-data { flex: 1; text-align: center; }
        .col-money { flex: 1.2; text-align: right; color: var(--accent); }
        
        .row-strongest { color: var(--success); }
        .row-strongest .col-name::after { content: ' ‚òÖ'; }
        .row-weakest { color: var(--danger); }
        .row-weakest .col-name::after { content: ' ‚ñº'; }
    </style>
</head>
<body>
    <header>
        <div class="brand">HOST CONTROL</div>
        <div class="timer-box">‚è± <span id="timerDisplay">20</span></div>
        <div class="bank-box"><div style="font-size:0.7rem; color:#888;">BANCO</div><div id="bankDisplay" class="bank-val">$0</div></div>
    </header>

    <div class="main-grid">
        <div class="panel">
            <small style="color:#888">FASES</small>
            <button id="btnPhaseWait" class="btn" onclick="setPhase('waiting')">‚è∏ ESPERA</button>
            <button id="btnPhaseQ" class="btn" onclick="setPhase('questions')">‚ñ∂ PREGUNTAS</button>
            <button id="btnPhaseVote" class="btn" onclick="setPhase('voting')">üó≥ VOTACI√ìN</button>
            <button id="btnPhaseElim" class="btn btn-danger" onclick="setPhase('elimination')">‚ò† ELIMINACI√ìN</button>
            
            <div style="margin-top: 20px;">
                <small style="color:#888">RONDA</small>
                <div id="roundDisplay" style="font-size:1.5rem; font-weight:bold">1</div>
            </div>
            <button class="btn btn-reset" onclick="resetGame()">üîÑ RESET TOTAL</button>
        </div>

        <div class="panel center-panel">
            <div id="turnDisplay" class="turn-banner">TURNO DE: --</div>

            <div id="questionArea" class="question-area">
                <div id="questionText" class="q-text">Esperando inicio...</div>
                <div id="answerText" class="a-text">Respuesta</div>
            </div>

            <div id="votingResultsArea" class="voting-area">
                <h3 style="text-align:center; margin:0 0 10px 0;">RESULTADOS VOTACI√ìN</h3>
                <div id="alertElim" class="vote-alert alert-elim">ELIMINAR A: <span id="elimTarget">--</span></div>
                <div id="alertTie" class="vote-alert alert-tie">¬°EMPATE! DECIDE: <span id="tieBreaker">--</span></div>
                <div id="votesList"></div>
            </div>
            
            <div id="hostLadder"></div>

            <div class="controls-area">
                <button id="btnWrong" class="big-btn b-wrong" onclick="socket.emit('wrongAnswer')">‚úñ MAL</button>
                <button id="btnBank" class="big-btn b-bank" onclick="socket.emit('bank')">
                    <span>üí∞ BANCA</span>
                    <span id="bankBtnVal" style="font-size: 0.9rem; margin-top: 2px;">$0</span>
                </button>
                <button id="btnCorrect" class="big-btn b-correct" onclick="socket.emit('correctAnswer')">‚úî BIEN</button>
            </div>
        </div>

        <div class="panel">
            <small style="color:#888">ELIMINAR</small>
            <select id="eliminationSelect"><option value="">Selecciona...</option></select>
            <button class="btn btn-danger" style="text-align:center; margin-top:5px; flex-shrink:0;" onclick="eliminate()">ELIMINAR</button>
            <hr style="border:0; border-top:1px solid #333; width:100%">
            
            <small style="color:#888">RANKING</small>
            <div class="stat-header">
                <span style="flex:2">JUG</span>
                <span style="flex:1; text-align:center">‚úî</span>
                <span style="flex:1; text-align:center">‚úñ</span>
                <span style="flex:1.2; text-align:right">üí≤</span>
            </div>
            <div id="rankingList" style="overflow-y:auto; flex:1;"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const els = {
            timer: document.getElementById('timerDisplay'),
            bank: document.getElementById('bankDisplay'),
            qText: document.getElementById('questionText'),
            aText: document.getElementById('answerText'),
            turn: document.getElementById('turnDisplay'),
            round: document.getElementById('roundDisplay'),
            rank: document.getElementById('rankingList'),
            elSelect: document.getElementById('eliminationSelect'),
            hLadder: document.getElementById('hostLadder'),
            bankBtnVal: document.getElementById('bankBtnVal'),
            qArea: document.getElementById('questionArea'),
            vArea: document.getElementById('votingResultsArea'),
            vList: document.getElementById('votesList'),
            alertElim: document.getElementById('alertElim'),
            alertTie: document.getElementById('alertTie'),
            elimTarget: document.getElementById('elimTarget'),
            tieBreaker: document.getElementById('tieBreaker'),
            // Control buttons
            btnWait: document.getElementById('btnPhaseWait'),
            btnQ: document.getElementById('btnPhaseQ'),
            btnVote: document.getElementById('btnPhaseVote'),
            btnElim: document.getElementById('btnPhaseElim'),
            gameBtns: [document.getElementById('btnWrong'), document.getElementById('btnBank'), document.getElementById('btnCorrect')]
        };

        function setPhase(p) { socket.emit('setPhase', p); }
        function eliminate() {
            const val = els.elSelect.value;
            if(val && confirm(`¬øEliminar a ${val}?`)) socket.emit('eliminatePlayer', val);
        }
        function resetGame() { if(confirm("‚ö† REINICIAR TODO?")) socket.emit('resetGame'); }

        socket.on('timerUpdate', t => els.timer.innerText = t);
        
        socket.on('phaseChanged', phase => {
            // 1. Limpiar estilos
            [els.btnWait, els.btnQ, els.btnVote, els.btnElim].forEach(b => {
                b.classList.remove('active', 'btn-next-step');
                b.disabled = false;
            });

            // 2. Gestionar Paneles Centrales
            if(phase === 'voting' || phase === 'times_up') {
                els.qArea.style.display = 'none';
                els.vArea.style.display = 'block';
            } else {
                els.qArea.style.display = 'flex';
                els.vArea.style.display = 'none';
                els.alertElim.style.display = 'none';
                els.alertTie.style.display = 'none';
            }

            // 3. PUNTO 5 y 6: L√≥gica de Botones (Sem√°foro y Bloqueo)
            if (phase === 'waiting') {
                els.btnWait.classList.add('active');
                els.btnQ.classList.add('btn-next-step'); // Sugerir Preguntas
                els.gameBtns.forEach(b => b.disabled = true); // Sin juego
            } 
            else if (phase === 'questions') {
                els.btnQ.classList.add('active');
                els.btnVote.classList.add('btn-next-step'); // Sugerir Votaci√≥n
                els.btnElim.disabled = true; // No eliminar durante preguntas
                els.gameBtns.forEach(b => b.disabled = false); // Juego Activo
            } 
            else if (phase === 'voting' || phase === 'times_up') {
                els.btnVote.classList.add('active');
                els.btnElim.classList.add('btn-next-step'); // Sugerir Eliminar
                els.btnQ.disabled = true; // No volver a preguntas sin eliminar
                els.gameBtns.forEach(b => b.disabled = true); // Juego Bloqueado
            } 
            else if (phase === 'elimination') {
                els.btnElim.classList.add('active');
                els.btnQ.classList.add('btn-next-step'); // Sugerir Siguiente Ronda
                els.btnVote.disabled = true;
                els.gameBtns.forEach(b => b.disabled = true);
            }
        });

        socket.on('bankState', s => {
            els.bank.innerText = `$${s.bankedTotal}`;
            els.bankBtnVal.innerText = `$${s.currentChainValue}`;
            els.hLadder.innerHTML = '';
            s.chain.forEach((val, idx) => {
                const div = document.createElement('div');
                div.className = `h-step ${idx === s.chainIndex ? 'active' : ''}`;
                div.innerText = `$${val}`;
                els.hLadder.appendChild(div);
            });
        });
        
        socket.on('questionUpdate', q => { 
            if(q) { els.qText.innerText = q.question; els.aText.innerText = q.answer; } 
            else { els.qText.innerText = "Esperando pregunta..."; els.aText.innerText = ""; }
        });
        
        socket.on('turnUpdate', p => els.turn.innerText = `TURNO DE: ${p || "--"}`);
        socket.on('roundUpdate', r => els.round.innerText = r);
        
        socket.on('playersUpdated', players => {
            els.elSelect.innerHTML = '<option value="">Selecciona...</option>';
            players.forEach(p => els.elSelect.innerHTML += `<option value="${p}">${p}</option>`);
        });

        socket.on('rankingUpdate', list => {
            list.sort((a,b) => b.correct - a.correct);
            els.rank.innerHTML = list.map((p, index) => {
                let rowClass = "";
                if (list.length > 1) {
                    if (index === 0) rowClass = "row-strongest";
                    if (index === list.length - 1) rowClass = "row-weakest";
                }
                // PUNTO 4: Columna Money
                return `
                <div class="stat-row ${rowClass}">
                    <span class="col-name">${p.name}</span>
                    <span class="col-data">${p.correct}</span>
                    <span class="col-data">${p.wrong}</span>
                    <span class="col-money">$${p.bankAmount}</span>
                </div>`;
            }).join('');
        });

        socket.on('votesUpdated', data => {
            els.vList.innerHTML = data.details.map(v => `
                <div class="vote-card">
                    <span class="voter-name">${v.voter} vot√≥ por...</span>
                    <span class="target-name">${v.target}</span>
                </div>
            `).join('');
        });

        socket.on('votingResult', res => {
            if(!res) {
                els.alertElim.style.display = 'none';
                els.alertTie.style.display = 'none';
                return;
            }
            if(res.type === 'clear') {
                els.alertElim.style.display = 'block';
                els.elimTarget.innerText = `${res.target} (${res.count} votos)`;
            } else if (res.type === 'tie') {
                els.alertTie.style.display = 'block';
                els.tieBreaker.innerText = res.decisionMaker;
            }
        });

        socket.on('gameReset', () => location.reload());
    </script>
</body>
</html>
