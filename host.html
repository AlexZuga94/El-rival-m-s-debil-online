<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOST - RIVAL M√ÅS D√âBIL</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --primary: #00d2ff; --accent: #f1c40f; --danger: #ff0055; --success: #00ff9d; --glass: rgba(255,255,255,0.08); }
        
        * { box-sizing: border-box; }
        
        body { 
            margin:0; padding:10px; background:var(--bg); color:white; font-family:'Outfit'; 
            /* TRUCO PARA TABLET: Usar dvh (Dynamic Viewport Height) */
            height: 100dvh; 
            width: 100vw;
            display:flex; 
            flex-direction: column;
            gap:10px; 
            overflow:hidden; 
        }
        
        /* HEADER FIJO */
        header { 
            flex-shrink: 0; /* No encoger */
            display:flex; justify-content:space-between; align-items:center; 
            background:var(--glass); padding:0 20px; border-radius:12px; height: 70px; 
        }
        .brand { font-weight:900; font-size:1.2rem; color:var(--primary); text-transform:uppercase; letter-spacing:1px; }
        .timer-box { font-size:2.5rem; font-weight:700; color:var(--primary); }
        .bank-box { text-align:right; } .bank-val { font-size:1.8rem; color:var(--accent); font-weight:bold; }

        /* GRID PRINCIPAL QUE OCUPA EL RESTO DEL ESPACIO */
        .main-grid { 
            flex: 1; /* Ocupa todo el espacio sobrante debajo del header */
            display:grid; grid-template-columns: 250px 1fr 250px; gap:10px; 
            min-height: 0; /* Vital para que el scroll interno funcione */
        }

        .panel { 
            background:var(--glass); border:1px solid rgba(255,255,255,0.1); border-radius:12px; padding:15px; 
            display:flex; flex-direction:column; gap:10px; 
            height: 100%; /* Llenar la altura de la grilla */
            overflow: hidden;
        }
        
        /* BOTONES LATERALES */
        .btn { padding:12px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; text-transform:uppercase; color:white; background:rgba(255,255,255,0.1); transition:0.2s; text-align:left; font-size: 0.9rem; }
        .btn:hover { background:rgba(255,255,255,0.2); }
        .btn.active { background:var(--primary); color:black; }
        .btn-danger { color:var(--danger); border:1px solid var(--danger); }
        
        /* PANEL CENTRAL (FLEXBOX MAGIC) */
        .center-panel { 
            display: flex; 
            flex-direction: column; 
            padding: 10px;
        } 
        
        .question-area { 
            flex: 1; /* Ocupa todo el espacio disponible */
            overflow-y: auto; /* Si la pregunta es muy larga, scrollear */
            padding: 20px; 
            background: rgba(0,0,0,0.3); 
            border-left: 4px solid var(--primary); 
            border-radius: 8px; 
            margin-bottom: 10px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .q-text { font-size:1.8rem; font-weight:bold; line-height:1.3; margin-bottom: 20px; }
        .a-text { font-size:1.5rem; color:var(--success); background:rgba(0,255,157,0.1); padding:5px 20px; border-radius:20px; }
        
        /* BOTONES DE CONTROL (FIJOS ABAJO) */
        .controls-area { 
            flex-shrink: 0; /* Nunca hacerse m√°s peque√±os */
            display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; height:80px; 
        }
        .big-btn { border:none; border-radius:8px; font-weight:900; font-size:1.2rem; cursor:pointer; text-transform:uppercase; color: white; }
        .b-wrong { background:var(--danger); }
        .b-bank { background:var(--accent); color:black; }
        .b-correct { background:var(--success); color:black; }
        .big-btn:active { transform: scale(0.95); opacity: 0.8; }

        /* ELEMENTOS DERECHA */
        select { width:100%; padding:10px; background:#222; color:white; border:1px solid #444; border-radius:5px; flex-shrink: 0; }
        .stat-row { display:flex; justify-content:space-between; font-size:0.9rem; border-bottom:1px solid #333; padding:5px 0; }
        
        /* RESET VISIBLE */
        .btn-reset { margin-top: auto; background: #300; border: 1px solid #500; color: #f88; text-align: center; flex-shrink: 0; }

        /* RESPONSIVE PARA TABLETS VERTICALES O M√ìVILES (Por si acaso) */
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
            .panel { height: auto; }
            .question-area { min-height: 200px; }
            body { overflow-y: auto; height: auto; }
        }
    </style>
</head>
<body>
    <header>
        <div class="brand">EL RIVAL M√ÅS D√âBIL<br><span style="font-size:0.8rem; color:#888;">PANEL DE CONTROL</span></div>
        <div class="timer-box">‚è± <span id="timerDisplay">20</span></div>
        <div class="bank-box"><div style="font-size:0.7rem; color:#888;">BANCO</div><div id="bankDisplay" class="bank-val">$0</div></div>
    </header>

    <div class="main-grid">
        <div class="panel">
            <small style="color:#888">FASES</small>
            <button class="btn" onclick="setPhase('waiting')">‚è∏ INTRO / ESPERA</button>
            <button class="btn" onclick="setPhase('questions')">‚ñ∂ PREGUNTAS</button>
            <button class="btn" onclick="setPhase('voting')">üó≥ VOTACI√ìN</button>
            <button class="btn btn-danger" onclick="setPhase('elimination')">‚ò† ELIMINACI√ìN</button>
            
            <div style="margin-top: 20px;">
                <small style="color:#888">RONDA</small>
                <div id="roundDisplay" style="font-size:1.5rem; font-weight:bold">1</div>
                <small style="color:#888">TURNO ACTUAL</small>
                <div id="turnDisplay" style="font-size:1.3rem; color:var(--primary); font-weight:bold;">--</div>
            </div>

            <button class="btn btn-reset" onclick="resetGame()">üîÑ RESET TOTAL</button>
        </div>

        <div class="panel center-panel">
            <div class="question-area">
                <div id="questionText" class="q-text">Esperando inicio...</div>
                <div id="answerText" class="a-text">Respuesta</div>
            </div>
            
            <div class="controls-area">
                <button class="big-btn b-wrong" onclick="socket.emit('wrongAnswer')">‚úñ MAL</button>
                <button class="big-btn b-bank" onclick="socket.emit('bank')">üí∞ BANCA</button>
                <button class="big-btn b-correct" onclick="socket.emit('correctAnswer')">‚úî BIEN</button>
            </div>
        </div>

        <div class="panel">
            <small style="color:#888">ELIMINAR JUGADOR</small>
            <select id="eliminationSelect"><option value="">Selecciona...</option></select>
            <button class="btn btn-danger" style="text-align:center; margin-top:5px; flex-shrink:0;" onclick="eliminate()">ELIMINAR</button>
            
            <hr style="border:0; border-top:1px solid #333; width:100%">
            <small style="color:#888">RANKING</small>
            <div id="rankingList" style="overflow-y:auto; flex:1;"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const els = {
            timer: document.getElementById('timerDisplay'),
            bank: document.getElementById('bankDisplay'),
            qText: document.getElementById('questionText'),
            aText: document.getElementById('answerText'),
            turn: document.getElementById('turnDisplay'),
            round: document.getElementById('roundDisplay'),
            rank: document.getElementById('rankingList'),
            elSelect: document.getElementById('eliminationSelect')
        };

        function setPhase(p) { socket.emit('setPhase', p); }
        function eliminate() {
            const val = els.elSelect.value;
            if(val && confirm(`¬øEliminar a ${val}?`)) socket.emit('eliminatePlayer', val);
        }
        function resetGame() {
            if(confirm("‚ö† ¬øEST√ÅS SEGURO? Esto borrar√° todo.")) {
                socket.emit('resetGame');
            }
        }

        socket.on('timerUpdate', t => els.timer.innerText = t);
        socket.on('bankState', s => els.bank.innerText = `$${s.bankedTotal}`);
        socket.on('questionUpdate', q => { if(q) { els.qText.innerText = q.question; els.aText.innerText = q.answer; } });
        socket.on('turnUpdate', p => els.turn.innerText = p || "--");
        socket.on('roundUpdate', r => els.round.innerText = r);
        
        socket.on('playersUpdated', players => {
            els.elSelect.innerHTML = '<option value="">Selecciona...</option>';
            players.forEach(p => els.elSelect.innerHTML += `<option value="${p}">${p}</option>`);
        });

        socket.on('rankingUpdate', list => {
            list.sort((a,b) => b.correct - a.correct);
            els.rank.innerHTML = list.map(p => `
                <div class="stat-row">
                    <span style="font-weight:bold; color:var(--primary)">${p.name}</span>
                    <span>‚úî${p.correct} <span style="color:#555">|</span> $${p.bankAmount}</span>
                </div>`).join('');
        });

        socket.on('gameReset', () => location.reload());
    </script>
</body>
</html>
