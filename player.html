<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JUGADOR - RIVAL MÁS DÉBIL</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000000; --primary: #00d2ff; --accent: #f1c40f; --danger: #e74c3c; --glass: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin:0; background:var(--bg); color:white; font-family:'Outfit'; height:100vh; display:flex; flex-direction:column; overflow:hidden; }

        /* HEADER APP */
        header { padding:15px; text-align:center; border-bottom:1px solid #333; background:#111; z-index:10; }
        .app-title { font-weight:900; font-size:1rem; letter-spacing:2px; color:var(--primary); text-transform:uppercase; }

        /* PANTALLAS (Capas) */
        .screen { position:absolute; top:0; left:0; width:100%; height:100%; display:none; flex-direction:column; align-items:center; justify-content:center; background:var(--bg); z-index:5; }
        .active { display:flex; }

        /* 1. LOGIN */
        .login-box { width:80%; text-align:center; }
        input { width:100%; padding:15px; background:#222; border:none; color:white; font-size:1.2rem; text-align:center; border-radius:10px; margin-bottom:15px; }
        .btn-start { width:100%; padding:15px; background:var(--primary); border:none; font-weight:bold; font-size:1.2rem; border-radius:10px; color:black; text-transform:uppercase; }

        /* 2. INTRO ANIMADA (Punto 9) */
        #introScreen { background: black; text-align:center; padding:20px; }
        .intro-text-1 { font-size:2rem; font-weight:300; animation: fadeIn 1s forwards; opacity:0; }
        .intro-text-2 { font-size:1.5rem; margin-top:10px; color:#888; animation: fadeIn 1s forwards 1s; opacity:0; }
        .intro-logo { font-size:3rem; font-weight:900; margin-top:20px; color:var(--primary); text-transform:uppercase; text-shadow:0 0 20px var(--primary); animation: zoomGlow 1.5s forwards 2s; opacity:0; transform:scale(0.5); }

        /* 3. GAME SCREEN */
        #gameScreen { padding-top:60px; /* espacio para header */ justify-content: flex-start; }
        
        /* ESCALERA GIGANTE (Punto 12) */
        #ladderContainer { flex:1; display:flex; flex-direction:column-reverse; justify-content:center; align-items:center; width:100%; padding:20px; gap:5px; }
        .step { width:90%; padding:10px; text-align:center; background:#1a1a1a; border-radius:8px; font-weight:bold; color:#555; transition:0.3s; font-size:1.2rem; }
        .step.active { background:var(--accent); color:black; transform:scale(1.1); box-shadow:0 0 20px rgba(241,196,15,0.4); z-index:2; }
        .step.passed { color:var(--primary); background:transparent; border:1px solid var(--primary); }

        /* INFO BAR (Dinero acumulado) */
        .bank-info { position:absolute; bottom:0; width:100%; background:#111; padding:20px; text-align:center; border-top:1px solid #333; }
        .bank-total-label { font-size:0.8rem; color:#888; }
        .bank-total-val { font-size:2rem; color:var(--accent); font-weight:bold; }

        /* OVERLAYS (Wait, Vote, Eliminate) */
        .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:50; display:none; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
        
        /* WAITING ROUND OVERLAY (Punto 10) */
        #roundWaitMsg { font-size:1.5rem; color:var(--primary); font-weight:bold; animation: pulse 1s infinite; }

        /* VOTING (Punto 13) */
        #votingGrid { display:grid; grid-template-columns:1fr 1fr; gap:15px; width:90%; margin-top:20px; }
        .vote-btn { padding:20px; background:#222; border:1px solid #444; color:white; font-weight:bold; font-size:1rem; border-radius:10px; }
        .vote-btn:active { background:var(--primary); color:black; }

        /* ELIMINATED (Punto 15) */
        #eliminatedScreen { background:rgba(100,0,0,0.95); }
        .elim-icon { font-size:4rem; margin-bottom:20px; }
        .elim-text { font-size:2rem; font-weight:900; text-transform:uppercase; }

        /* ANIMACIONES */
        @keyframes fadeIn { to { opacity:1; } }
        @keyframes zoomGlow { to { opacity:1; transform:scale(1); text-shadow:0 0 40px var(--primary); } }
        @keyframes pulse { 0%{opacity:0.5} 50%{opacity:1} 100%{opacity:0.5} }
    </style>
</head>
<body>

    <header>
        <div class="app-title">EL RIVAL MÁS DÉBIL</div>
    </header>

    <div id="loginScreen" class="screen active">
        <div class="login-box">
            <h2 style="color:var(--primary)">ÚNETE AL JUEGO</h2>
            <input type="text" id="pName" placeholder="Tu Nombre" maxlength="10">
            <button class="btn-start" onclick="enterGame()">ENTRAR</button>
        </div>
    </div>

    <div id="introScreen" class="screen">
        <div id="intro1" class="intro-text-1">¡Hola!</div>
        <div class="intro-text-2">Juguemos a...</div>
        <div class="intro-logo">EL RIVAL<br>MÁS DÉBIL</div>
    </div>

    <div id="gameScreen" class="screen">
        <div id="ladderContainer"></div> <div class="bank-info">
            <div class="bank-total-label">BANCO ACUMULADO</div>
            <div id="bankTotal" class="bank-total-val">$0</div>
        </div>
        
        <div id="waitingOverlay" class="overlay" style="background:rgba(0,0,0,0.8);">
            <div id="roundWaitMsg">Esperando inicio...</div>
        </div>
    </div>

    <div id="voteScreen" class="overlay">
        <h2 style="color:var(--accent)">¿QUIÉN ES EL RIVAL MÁS DÉBIL?</h2>
        <div id="votingGrid"></div>
    </div>

    <div id="eliminatedScreen" class="overlay">
        <div class="elim-icon">☠</div>
        <div class="elim-text">HAS SIDO<br>ELIMINADO</div>
        <p>Gracias por jugar.</p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myName = "";
        
        // Elementos
        const els = {
            login: document.getElementById('loginScreen'),
            intro: document.getElementById('introScreen'),
            game: document.getElementById('gameScreen'),
            vote: document.getElementById('voteScreen'),
            elim: document.getElementById('eliminatedScreen'),
            ladder: document.getElementById('ladderContainer'),
            bank: document.getElementById('bankTotal'),
            waitOver: document.getElementById('waitingOverlay'),
            waitMsg: document.getElementById('roundWaitMsg'),
            vGrid: document.getElementById('votingGrid'),
            introName: document.getElementById('intro1')
        };

        function enterGame() {
            const name = document.getElementById('pName').value.trim();
            if(!name) return;
            myName = name;
            socket.emit('registerPlayer', name);
            
            // SECUENCIA INTRO (Puntos 9 y 10)
            els.login.classList.remove('active');
            els.intro.classList.add('active');
            els.introName.innerText = `¡Hola ${name}!`;
            
            setTimeout(() => {
                els.intro.classList.remove('active');
                els.game.classList.add('active');
                // Dejar el overlay de espera activo hasta que el Host inicie
                els.waitOver.style.display = 'flex';
                els.waitMsg.innerText = "Esperando al Host...";
            }, 4500); // 4.5 segundos de intro
        }

        // SOCKETS LOGIC
        socket.on('gameReset', () => location.reload());

        socket.on('playerEliminated', (name) => {
            if(name.toUpperCase() === myName.toUpperCase()) {
                els.elim.style.display = 'flex'; // Mostrar overlay eliminado
            }
        });

        socket.on('phaseChanged', (phase) => {
            // Ocultar overlays temporales
            if(phase !== 'waiting') els.waitOver.style.display = 'none';
            els.vote.style.display = 'none';

            if(phase === 'waiting') {
                els.waitOver.style.display = 'flex';
                els.waitMsg.innerText = "Pausa / Instrucciones";
            }
            if(phase === 'questions') {
                els.waitOver.style.display = 'none'; // A JUGAR!
            }
            if(phase === 'voting') {
                els.vote.style.display = 'flex'; // Mostrar votación
            }
        });

        socket.on('roundUpdate', r => {
            if(els.waitMsg.innerText.includes("Esperando")) {
                els.waitMsg.innerText = `Esperando comenzar RONDA ${r}`;
            }
        });

        socket.on('bankState', state => {
            // Actualizar total
            els.bank.innerText = `$${state.bankedTotal}`;
            
            // Render Escalera (Inversa visualmente)
            els.ladder.innerHTML = '';
            [...state.chain].reverse().forEach((val, idx) => {
                const realIdx = state.chain.length - 1 - idx;
                const div = document.createElement('div');
                div.className = `step ${realIdx === state.chainIndex ? 'active' : ''} ${realIdx < state.chainIndex ? 'passed' : ''}`;
                div.innerText = `$${val}`;
                els.ladder.appendChild(div);
            });
        });

        socket.on('playersUpdated', players => {
            // Llenar grilla de votación
            els.vGrid.innerHTML = '';
            players.forEach(p => {
                if(p !== myName.toUpperCase()) {
                    const btn = document.createElement('button');
                    btn.className = 'vote-btn';
                    btn.innerText = p;
                    btn.onclick = () => {
                        socket.emit('vote', p);
                        els.vote.style.display = 'none'; // Ocultar al votar
                        els.waitOver.style.display = 'flex';
                        els.waitMsg.innerText = "Voto Registrado";
                    };
                    els.vGrid.appendChild(btn);
                }
            });
        });

    </script>
</body>
</html>
